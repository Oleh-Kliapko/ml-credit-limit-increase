# metrics_report.py
# –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–≤—ñ—Ç—É –ø–æ –º–µ—Ç—Ä–∏–∫–∞—Ö –º–æ–¥–µ–ª—ñ –∑ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—î—é —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏

import pandas as pd


METRIC_GUIDE = {
    "auc": [
        (0.5, "‚ùå –í–∏–ø–∞–¥–∫–æ–≤–∞ –∞–±–æ –≥—ñ—Ä—à–µ"),
        (0.6, "‚ö†Ô∏è –°–ª–∞–±–∫–∏–π —Å–∏–≥–Ω–∞–ª"),
        (0.7, "‚úÖ –•–æ—Ä–æ—à–∞ –¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ü—ñ—è"),
        (1.0, "üî• –î—É–∂–µ —Å–∏–ª—å–Ω–∞ –º–æ–¥–µ–ª—å"),
    ],
    "gini": [
        (0.0, "‚ùå –ù–µ–º–∞—î –¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ü—ñ—ó"),
        (0.2, "‚ö†Ô∏è –°–ª–∞–±–∫–∞ –º–æ–¥–µ–ª—å"),
        (0.3, "‚úÖ –ü—Ä–∏–π–Ω—è—Ç–Ω–∞ –º–æ–¥–µ–ª—å"),
        (1.0, "üî• –°–∏–ª—å–Ω–∞ –º–æ–¥–µ–ª—å"),
    ],
    "precision": [
        (0.05, "‚ùå –ú–∞–π–∂–µ –≤—Å—ñ –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ –ø—Ä–æ–≥–Ω–æ–∑–∏ —Ö–∏–±–Ω—ñ"),
        (0.15, "‚ö†Ô∏è –ù–∏–∑—å–∫–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å"),
        (0.3, "‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å"),
        (1.0, "üî• –í–∏—Å–æ–∫–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å"),
    ],
    "recall": [
        (0.3, "‚ùå –ë–∞–≥–∞—Ç–æ –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö —Ä–∏–∑–∏–∫—ñ–≤"),
        (0.6, "‚ö†Ô∏è –°–µ—Ä–µ–¥–Ω—î –ø–æ–∫—Ä–∏—Ç—Ç—è"),
        (0.8, "‚úÖ –î–æ–±—Ä–µ –ª–æ–≤–∏—Ç—å —Ä–∏–∑–∏–∫–∏"),
        (1.0, "üî• –ú–∞–π–∂–µ –≤—Å—ñ—Ö –∑–Ω–∞—Ö–æ–¥–∏—Ç—å"),
    ],
    "f1": [
        (0.1,  "‚ùå –ú–æ–¥–µ–ª—å –∞–±–æ –º–∞–π–∂–µ –Ω–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–∏–∑–∏–∫, –∞–±–æ —Å–∏–ª—å–Ω–æ –ø–æ–º–∏–ª—è—î—Ç—å—Å—è"),
        (0.25, "‚ö†Ô∏è –ú–æ–¥–µ–ª—å —á–∞—Å—Ç–∫–æ–≤–æ –ø—Ä–∞—Ü—é—î, –∞–ª–µ –±–∞–ª–∞–Ω—Å —Å–ª–∞–±–∫–∏–π"),
        (0.4,  "‚úÖ –ú–æ–¥–µ–ª—å –¥–æ–±—Ä–µ –ø–æ—î–¥–Ω—É—î –ø–æ—à—É–∫ —Ä–∏–∑–∏–∫—É —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å"),
        (1.0,  "üî• –ú–æ–¥–µ–ª—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ —Ç–æ—á–Ω–æ —ñ –ø–æ–≤–Ω–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–∏–∑–∏–∫"),
    ],
    "f2": [
        (0.15, "‚ùå –ú–æ–¥–µ–ª—å —á–∞—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞—î —Ä–∏–∑–∏–∫–∏"),
        (0.3,  "‚ö†Ô∏è –ú–æ–¥–µ–ª—å –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —á–∞—Å—Ç–∏–Ω—É —Ä–∏–∑–∏–∫—ñ–≤, –∞–ª–µ –Ω–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ"),
        (1.0,  "üî• –ú–æ–¥–µ–ª—å –¥–æ–±—Ä–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–∏–∑–∏–∫ —ñ –º–∞–π–∂–µ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—î –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π"),
    ]
}


def interpret_metric(metric_name, value):
    for threshold, text in METRIC_GUIDE[metric_name]:
        if value < threshold:
            return text
    return "‚Äî"


def build_metrics_report(metrics: dict):
    rows = []

    for metric, value in metrics.items():
        if metric not in METRIC_GUIDE:
            continue

        rows.append({
            "–ú–µ—Ç—Ä–∏–∫–∞": metric.upper(),
            "–ó–Ω–∞—á–µ–Ω–Ω—è": round(value, 4),
            "–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è": interpret_metric(metric, value)
        })

    df_report = pd.DataFrame(rows)

    print("\n\n=== üìä –ó–≤—ñ—Ç –ø–æ —è–∫–æ—Å—Ç—ñ –º–æ–¥–µ–ª—ñ ===")
    print("\n" + df_report.to_string(index=False))


def final_conclusion(metrics):
    auc = metrics["auc"]
    recall = metrics["recall"]
    precision = metrics["precision"]

    if auc < 0.6:
        return "‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –º–∞—î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ—ó –¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ü—ñ–π–Ω–æ—ó –∑–¥–∞—Ç–Ω–æ—Å—Ç—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ –±—ñ–∑–Ω–µ—Å—ñ —Ä–∞–Ω–æ.\n"

    if recall > 0.6 and precision < 0.1:
        return (
            "‚ö†Ô∏è –ú–æ–¥–µ–ª—å –¥–æ–±—Ä–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–∏–∑–∏–∫, "
            "–∞–ª–µ —á–∞—Å—Ç–æ –ø–æ–º–∏–ª–∫–æ–≤–æ –ø–æ–∑–Ω–∞—á–∞—î –±–µ–∑–ø–µ—á–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ —è–∫ —Ä–∏–∑–∏–∫–æ–≤–∏—Ö.\n"
        )

    if recall < 0.4:
        return (
            "‚ùå –ú–æ–¥–µ–ª—å –ø—Ä–æ–ø—É—Å–∫–∞—î –∑–Ω–∞—á–Ω—É —á–∞—Å—Ç–∏–Ω—É —Ä–∏–∑–∏–∫–æ–≤–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤. "
            "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–µ–±–µ–∑–ø–µ—á–Ω–µ.\n"
        )

    return "‚úÖ –ú–æ–¥–µ–ª—å –º–∞—î –ø—Ä–∏–π–Ω—è—Ç–Ω–∏–π –±–∞–ª–∞–Ω—Å —ñ –º–æ–∂–µ –±—É—Ç–∏ –±–∞–∑–æ—é –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ —Ä–æ–∑–≤–∏—Ç–∫—É.\n"


def next_step_recommendation(metrics):
    auc = metrics["auc"]
    precision = metrics["precision"]
    recall = metrics["recall"]

    if auc < 0.6:
        return (
            "\nüîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—ñ—á—ñ –∞–±–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –Ω–µ–ª—ñ–Ω—ñ–π–Ω—É –º–æ–¥–µ–ª—å "
            "(Decision Tree, XGBoost)."
        )

    if recall > 0.6 and precision < 0.1:
        return (
            "\nüéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: –ø—ñ–¥–Ω—è—Ç–∏ –ø–æ—Ä—ñ–≥ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó "
            "–∞–±–æ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –º–æ–¥–µ–ª—å –ø–æ Precision/F1."
        )

    if recall < 0.4:
        return (
            "üö® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –º–æ–¥–µ–ª—å –ø–æ Recall/F2 "
            "–∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—ñ–≤."
        )

    return (
        "üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: –ø–µ—Ä–µ–π—Ç–∏ –¥–æ GridSearch —ñ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ —ñ–Ω—à–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏."
    )
